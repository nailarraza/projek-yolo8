{% extends "layouts/base.html" %}
{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12 text-center mb-4">
            <h1>Dashboard Deteksi Kualitas Oli</h1>
            <p class="lead">Selamat datang, {{ current_user.username }}!</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Tampilan Kamera ESP32-CAM (Realtime)</h5>
                </div>
                <div class="card-body text-center">
                    <img id="cameraStream" src="https://placehold.co/640x480/333/FFF?text=Stream+Kamera+ESP32-CAM" alt="Stream Kamera ESP32-CAM" class="img-fluid rounded border" style="max-height: 480px;">
                    <p class="mt-2 text-muted" id="streamStatus">Menunggu stream dari ESP32-CAM...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
             <form method="POST" action="{{ url_for('main.capture_and_detect') }}" id="captureForm">
                <button type="submit" class="btn btn-primary-custom btn-lg shadow" id="captureButton">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-camera-fill me-2" viewBox="0 0 16 16">
                        <path d="M10.5 8.5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                        <path d="M2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4zm.5 2a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m9-1a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1"/>
                    </svg>
                    Tangkap & Deteksi Gambar
                </button>
            </form>
            <p class="mt-3 text-muted">Klik tombol di atas untuk mengambil gambar dari ESP32-CAM dan memulai proses deteksi kualitas oli.</p>
        </div>
    </div>
</div>
{% endblock content %}

{% block scripts %}
{{ super() }} {# Memanggil block scripts dari base.html jika ada #}
<script>
    // Logika untuk menampilkan stream ESP32-CAM akan ditambahkan di Tahap 8
    // Contoh:
    // const cameraStreamElement = document.getElementById('cameraStream');
    // const esp32CamUrl = "{{ config.ESP32_CAM_URL }}"; // Ambil dari config Flask
    // if (esp32CamUrl && esp32CamUrl !== 'http://ALAMAT_IP_ESP32_CAM_ANDA') {
    //     // Biasanya stream dari ESP32 CAM adalah MJPEG, bisa langsung diset ke src <img>
    //     // atau jika endpointnya adalah untuk snapshot, perlu refresh periodik
    //     // Untuk stream video:
    //     // cameraStreamElement.src = esp32CamUrl + ":81/stream"; // Contoh URL stream ESP32-CAM
    //     // Untuk snapshot periodik:
    //     // setInterval(() => {
    //     //    cameraStreamElement.src = esp32CamUrl + "/capture?t=" + new Date().getTime();
    //     // }, 1000); // Refresh setiap 1 detik
    //     document.getElementById('streamStatus').textContent = 'Mencoba menghubungkan ke ESP32-CAM...';
    // } else {
    //     document.getElementById('streamStatus').textContent = 'URL ESP32-CAM belum dikonfigurasi.';
    // }

    // const captureButton = document.getElementById('captureButton');
    // captureButton.addEventListener('click', function() {
    //     // Bisa tambahkan animasi loading atau feedback di sini
    //     this.disabled = true;
    //     this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Memproses...';
    //     document.getElementById('captureForm').submit();
    // });
</script>
{% endblock scripts %}