{% extends "layout.html" %}

{% block title %}Hasil Deteksi Oli{% endblock %}

{% block content %}
<div class="container mt-4">
    {% if detection %}
        <h2>Hasil Deteksi Kualitas Oli</h2>
        <p class="text-muted">Deteksi dilakukan pada: {{ detection.timestamp.strftime('%d %B %Y, %H:%M:%S') if detection.timestamp else 'N/A' }}</p>
        <hr>
        <div class="card mb-3">
            <div class="row g-0">
                <div class="col-md-7">
                    {% if detection.image_path %}
                    <img src="{{ url_for('static', filename=detection.image_path) }}" 
                         class="img-fluid rounded-start" alt="Gambar Hasil Deteksi: {{ detection.image_name }}"
                         onerror="this.onerror=null; this.src='https://placehold.co/600x400/dddddd/999999?text=Gambar+Tidak+Ditemukan';">
                    {% else %}
                    <img src="https://placehold.co/600x400/dddddd/999999?text=Gambar+Tidak+Tersedia" 
                         class="img-fluid rounded-start" alt="Gambar Tidak Tersedia">
                    {% endif %}
                </div>
                <div class="col-md-5">
                    <div class="card-body">
                        <h5 class="card-title">Detail Deteksi</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <strong>Nama File Asli:</strong> {{ detection.image_name if detection.image_name else 'N/A' }}
                            </li>
                            <li class="list-group-item">
                                <strong>Kelas Terdeteksi:</strong> 
                                <span class="fw-bold">
                                    {% if detection.detection_class == "Oli Baik" %}
                                        <span class="badge bg-success">{{ detection.detection_class }}</span>
                                    {% elif detection.detection_class == "Oli Perlu Ganti" %}
                                        <span class="badge bg-warning text-dark">{{ detection.detection_class }}</span>
                                    {% elif detection.detection_class %}
                                        <span class="badge bg-danger">{{ detection.detection_class }}</span>
                                    {% else %}
                                        <span class="badge bg-secondary">N/A</span>
                                    {% endif %}
                                </span>
                            </li>
                            <li class="list-group-item">
                                <strong>Tingkat Akurasi:</strong> 
                                {{ '%.2f%%'|format(detection.confidence_score * 100) if detection.confidence_score is not none else 'N/A' }}
                            </li>
                        </ul>
                        <hr>
                        <h6>Deskripsi (dari Gemini API - Placeholder):</h6>
                        <p class="card-text"><em>{{ detection.generative_description if detection.generative_description else 'Deskripsi tidak tersedia.' }}</em></p>

                        <div class="mt-3">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Deteksi Lagi</a>
                            <a href="{{ url_for('histori') }}" class="btn btn-secondary">Lihat Semua Histori</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="alert alert-warning" role="alert">
            Data deteksi tidak ditemukan. Mungkin ID tidak valid atau Anda tidak memiliki akses.
        </div>
        <a href="{{ url_for('histori') }}" class="btn btn-primary">Kembali ke Histori</a>
    {% endif %}
</div>
{% endblock %}